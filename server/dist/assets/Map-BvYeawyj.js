import{r as l,G as f,j as e}from"./index-DHdrx00N.js";import{a as x}from"./axios-C8DqakIB.js";import{c as j,l as y,b,L as m,M as v,T as w,a as D}from"./leaflet-DOuSLvSV.js";const C=j(function(s,a){const o=new y.Popup(s,a.overlayContainer);return b(o,a)},function(s,a,{position:o},n){l.useEffect(function(){const{instance:r}=s;function d(c){c.popup===r&&(r.update(),n(!0))}function g(c){c.popup===r&&n(!1)}return a.map.on({popupopen:d,popupclose:g}),a.overlayContainer==null?(o!=null&&r.setLatLng(o),r.openOn(a.map)):a.overlayContainer.bindPopup(r),function(){var t;a.map.off({popupopen:d,popupclose:g}),(t=a.overlayContainer)==null||t.unbindPopup(),a.map.removeLayer(r)}},[s,a,n,o])}),R="http://localhost:3000";delete m.Icon.Default.prototype._getIconUrl;m.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const N=()=>{const[u,s]=l.useState([]),[a,o]=l.useState(null),[n,p]=l.useState({dateRange:null,category:""}),{token:r}=f(),[d,g]=l.useState(r);l.useEffect(()=>{(async()=>{try{const i={headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"}},h=await x.get(`${R}/api/incidents/getAllIncidents`,i);s(h.data)}catch(i){console.error("Error fetching incidents:",i)}})()},[]);const c=u.filter(t=>{const i=n.category?t.category===n.category:!0,h=n.dateRange?new Date(t.date)>=n.dateRange[0]&&new Date(t.date)<=n.dateRange[1]:!0;return i&&h});return e.jsx("div",{className:"flex flex-col min-h-screen",children:e.jsxs("div",{className:"flex-1 mt-16",children:[e.jsx("h2",{className:"text-center text-4xl mb-2 bg-pink-500 text-white py-2",children:"Incident Reports Map"}),e.jsx("div",{className:"h-[calc(100vh-200px)] border border-gray-300",children:e.jsxs(v,{center:[29.95488,76.819534],zoom:15,className:"h-full w-full",children:[e.jsx(w,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"Â© <a href='https://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors"}),c.map(t=>e.jsx(D,{position:[t.location.coordinates[1],t.location.coordinates[0]],eventHandlers:{click:()=>o(t)},children:e.jsx(C,{children:t.category})},t._id))]})}),e.jsxs("div",{className:"mt-2 flex justify-center gap-2",children:[e.jsxs("select",{value:n.category,onChange:t=>p({...n,category:t.target.value}),className:"p-2 border border-gray-300 rounded",children:[e.jsx("option",{value:"",disabled:!0,children:"Select Category"}),e.jsx("option",{value:"mistreatment",children:"Mistreatment"}),e.jsx("option",{value:"hooligans",children:"Hooligans"}),e.jsx("option",{value:"cat-calling",children:"Cat-calling"}),e.jsx("option",{value:"shady-area",children:"Shady Area"})]}),e.jsx("input",{type:"date",placeholder:"Start Date",onChange:t=>p({...n,dateRange:[new Date(t.target.value),n.dateRange?n.dateRange[1]:new Date]}),className:"p-2 border border-gray-300 rounded"}),e.jsx("input",{type:"date",placeholder:"End Date",onChange:t=>p({...n,dateRange:[n.dateRange?n.dateRange[0]:new Date,new Date(t.target.value)]}),className:"p-2 border border-gray-300 rounded"})]}),a&&e.jsxs("div",{className:"mt-2 p-2 border border-gray-300 text-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Incident Details"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Description:"})," ",a.description]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Category:"})," ",a.category]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",new Date(a.date).toLocaleDateString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Time:"})," ",new Date(a.date).toLocaleTimeString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Reported by:"})," ",a.name||"Anonymous"]})]})]})})};export{N as default};
